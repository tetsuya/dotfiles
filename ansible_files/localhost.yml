- hosts: localhost
  connection: local
  gather_facts: no
  sudo: no
  vars:
    homebrew_taps:
      - homebrew/services
      - caskroom/cask
    homebrew_packages:
      - { name: git }
      - { name: mysql }
      - { name: rbenv }
      - { name: ruby-build }
    homebrew_cask_packages:
      - { name: 1password }
      - { name: appcleaner }
      - { name: atom }
      - { name: caffeine }
      - { name: dash }
      - { name: dropbox }
      - { name: evernote }
      - { name: flux }
      - { name: google-chrome }
      - { name: google-drive }
      - { name: hub }
      - { name: iterm2 }
      - { name: mailbox }
      - { name: sequel-pro }
      - { name: skitch }
      - { name: skype }
      - { name: slack }
      - { name: vagrant }
      - { name: virtualbox }

  tasks:
    - name: tap homebrew repositories
      homebrew_tap: tap={{ item }} state=present
      with_items: homebrew_taps

    - name: update homebrew
      homebrew: update_homebrew=yes upgrade_all=yes

    - name: install brew packages
      homebrew: name={{ item.name }} state={{ item.state | default('latest') }} install_options={{ item.install_options | default() }}
      with_items: homebrew_packages

    - name: install homebrew-cask
      homebrew: name=brew-cask state=latest

    - name: install brew cask packages
      homebrew_cask: name={{ item.name }} state={{ item.state | default('installed') }}
      with_items: homebrew_cask_packages

    - name: start mysql at login
      shell: brew services start mysql

    - name: copy .bash_aliases
      copy: src=./files/.bash_aliases dest=~/.bash_aliases
      register: dot_bash_aliases

    - name: copy .bash_exports
      copy: src=./files/.bash_exports dest=~/.bash_exports
      register: dot_bash_exports

    - name: copy .bash_profile
      copy: src=./files/.bash_profile dest=~/.bash_profile
      register: dot_bash_profile

    - name: copy .bash_prompt
      copy: src=./files/.bash_prompt dest=~/.bash_prompt
      register: dot_bash_prompt

    - name: copy .gitconfig
      copy: src=./files/.gitconfig dest=~/.gitconfig
      register: dot_gitconfig

    - name: copy .inputrc
      copy: src=./files/.inputrc dest=~/.inputrc
      register: dot_inputrc

    - name: load dotfile settings
      shell: source ~/.bash_profile
      when: dot_bash_aliases.changed or dot_bash_exports.changed or dot_bash_profile.changed or dot_bash_prompt.changed or dot_gitconfig.changed or dot_inputrc.changed

    - name: Set computer name (as done via System Preferences â†’ Sharing)
      sudo: yes
      command: "{{ item }}"
      with_items:
        - scutil --set ComputerName "mbp"
        - scutil --set HostName "mbp"
        - scutil --set LocalHostName "mbp"

    - name: enable tap to click for this user and for the login screen
      shell: "{{ item }}"
      with_items:
        - defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
        - defaults -currentHost write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
        - defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1

    - name: map bottom right corner to right-click
      shell: "{{ item }}"
      with_items:
        - defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadCornerSecondaryClick -int 2
        - defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadRightClick -bool true
        - defaults -currentHost write NSGlobalDomain com.apple.trackpad.trackpadCornerClickBehavior -int 1
        - defaults -currentHost write NSGlobalDomain com.apple.trackpad.enableSecondaryClick -bool true

    - name: automatically hide and show the Dock
      shell: defaults write com.apple.dock autohide -bool true

    - name: disable the drop-shadow on screenshots
      shell: "{{ item }}"
      with_items:
        - defaults write com.apple.screencapture disable-shadow -bool true
        - killall SystemUIServer
